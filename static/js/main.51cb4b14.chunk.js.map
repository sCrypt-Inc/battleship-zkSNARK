{"version":3,"sources":["web3/whatsonchain.ts","web3/sensiletwallet.ts","web3/wallet.ts","web3/web3.ts","WelcomeScreen.js","storage.js","Game/balance.js","Game/ReplicaBox.js","Game/PlayerFleet.js","Game/layoutHelpers.js","Game/PlayerBoard.js","Game/ComputerBoard.js","Game/PlayerTips.js","Game/GameView.js","circomProvider.js","Game/Game.js","Header.js","Footer.js","index.js","web3/gorillapool.ts"],"names":["Whatsonchain","network","API_PREFIX","Network","Testnet","TX_URL_PREFIX","rawTx","size","Math","max","length","time","axios","method","url","data","Buffer","from","headers","timeout","maxBodyLength","Infinity","txid","message","isAxiosError","ae","JSON","stringify","response","Error","address","get","SensiletWallet","sensilet","window","console","log","DEBUG_TAG","warn","name","permissions","this","requestAccount","alert","open","isConnect","isConnected","error","getBsvBalance","res","balance","Promise","resolve","total","rawtx","script","satoshis","inputIndex","sigHashType","signTx","list","txHex","getAddressFromP2PKH","scriptHex","sigtype","unlockScript","bsv","Script","add","sigList","sig","publicKey","toHex","signature","publickey","Gorillapool","sendRawTransaction","minAmount","options","getAddress","listUnspent","then","filter","utxo","value","map","txId","tx_hash","outputIndex","tx_pos","buildPublicKeyHashOut","getPublicKey","a","Address","fromString","Mainnet","wallet","pubKeyHash","fromHex","toASM","split","toString","SignType","setNetwork","web3","getRawChangeAddress","contract","amountInContract","changeAddress","purpose","utxos","tx","Transaction","addOutput","Output","lockingScript","change","signRawTransaction","ALL","inputs","setScript","sendRawTx","contractUtxo","cbBuildTx","prevLockingScript","addInput","Input","prevTxId","output","WelcomeScreen","startPlay","desc","setDesc","useState","loading","setLoading","useEffect","loadContractDesc","fetchContract","catch","e","className","onClick","Player","PlayerPrivkey","player","localStorage","getItem","key","setItem","PlayerPublicKey","privateKey","PrivateKey","fromWIF","PublicKey","fromPrivateKey","PlayerPKH","pkh","crypto","Hash","sha256ripemd160","toBuffer","ContractUtxos","index","id","outputs","push","set","utxosStr","parse","getComputerUtxoByIndex","find","getPlayerUtxoByIndex","clear","getlast","getdeploy","Balance","_balance","setBalance","setAddress","getbalance","getNetwork","ReplicaBox","shipName","selectShip","availableShips","isCurrentlyPlacing","ship","item","allReplicaSquares","Array","fill","PlayerFleet","currentlyPlacing","startTurn","startAgain","shipReplicaBoxes","fleet","playButton","SQUARE_STATE","stateToClass","generateEmptyLayout","BOARD_ROWS","coordsToIndex","coordinates","x","y","indexToCoords","floor","entityIndices","entity","position","indices","i","orientation","entityIndices2","putEntityInLayout","oldLayout","type","newLayout","slice","forEach","idx","canBePlaced","layout","isWithinBounds","every","isPlaceFree","generateRandomIndex","BOARD_COLUMNS","random","randomizeShipProps","randomStartIndex","updateSunkShips","currentHits","opponentShips","playerHitIndices","hit","includes","sunk","PlayerBoard","setCurrentlyPlacing","rotateShip","placeShip","placedShips","hitsByComputer","hitsProofToComputer","playSound","reduce","prevLayout","currentShip","currentHit","isPlacingOverBoard","canPlaceCurrentShip","forbiddenShip","squares","square","hitProofStatus","onMouseDown","status","getTxUri","focus","onMouseOver","ComputerBoard","computerShips","gameState","hitsByPlayer","setHitsByPlayer","handleComputerTurn","checkIfGameOver","setComputerShips","handleFire","hitsProofToPlayer","compLayout","fireTorpedo","newHits","successfulYourHits","successfulComputerHits","yourTurn","playerCanFire","alreadyHit","compSquares","shipsWithSunkFlag","sunkShipsAfter","sunkShipsBefore","PlayerTips","hitsbyPlayer","winner","deployTxid","numberOfHits","numberOfSuccessfulHits","accuracyScore","round","succesfulComputerHits","gameOverPanel","tipsPanel","href","target","rel","substr","GameView","computerShipsHash","changeTurn","hitComputer","CircomProvider","program","proving_key","verification_key","instance","fetch","resp","json","witness","snarkjs","groth16","fullProve","proof","publicSignals","isHit","verify","AVAILABLE_SHIPS","placed","runCircom","privateInputs","publicInputs","init","generateProof","isVerified","Game","setGameState","setWinner","setPlacedShips","placedShipsHash","setPlacedShipsHash","setAvailableShips","setComputerShipsHash","setHitsByComputer","Map","setHitsProofToComputer","setHitsProofToPlayer","battleShipContract","setBattleShipContract","setDeployTxid","queue","setQueue","hp2CRef","useRef","current","hp2PRef","hbpRef","hbcRef","Queue","concurrent","interval","stop","move","isPlayerFired","newStates","call","amount","getEstimateFee","setOutput","newLockingScript","getNewStateScript","setInputScript","preimage","getPreimage","currentTurn","toScript","seal","timeEnd","setTimeout","computerShips_","generateComputerShips","BattleShip","buildContractClass","shipHash","playerHash","computerHash","PubKey","Int","deploy","oldGameState","placedComputerShips","decoratedShip","placeAllComputerShips","successfulPlayerHits","role","targetIdx","toPrivateInputs","enqueue","Proof","getTypeClassByType","G1Point","G2Point","FQ2","pi_a","b","pi_b","c","pi_c","sortShipsForZK","ships","SORTED_ZK_SHIP_NAMES","sort","indexOf","multiplier","shipPreimage","val","r","BigInt","buildMimc7","mimc7","F","hash","sunkSoundRef","clickSoundRef","lossSoundRef","winSoundRef","stopSound","sound","pause","currentTime","play","Fragment","ref","src","preload","shipIdx","findIndex","shipToPlace","event","button","previousShips","potentialTargets","hitIndex","flatMap","coords","firstRow","lastRow","firstColumn","lastColumn","neighbors","Set","number","getNeighbors","computerHits","fireResult","sunkShips","computerFire","Header","aria-label","Footer","App","appState","setAppState","FEE_PER_KB","document","createElement","async","body","appendChild","removeChild","setWallet","n","aliceKey","fromRandom","toWIF","bobKey","initPlayer","ReactDOM","render","getElementById","txhex","payload","returnResult","resultDescription"],"mappings":"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","file":"static/js/main.51cb4b14.chunk.js","sourcesContent":["import axios, { AxiosError } from 'axios';\nimport { Network } from './wallet';\n\nexport class Whatsonchain {\n    static API_PREFIX = ``;\n    static TX_URL_PREFIX = ``;\n    static setNetwork(network: Network) {\n\n        Whatsonchain.API_PREFIX = `https://api.whatsonchain.com/v1/bsv/${network === Network.Testnet ? 'test' : 'main'}`;\n        Whatsonchain.TX_URL_PREFIX = `${network === Network.Testnet ? 'https://classic-test.whatsonchain.com/tx' : 'https://classic.whatsonchain.com/tx'}`;\n    }\n\n    \n    static async sendRawTransaction(rawTx: string) {\n\n\n        // 1 second per KB\n        const size = Math.max(1, rawTx.length / 2 / 1024); //KB\n        const time = Math.max(100000, 1000 * size);\n\n        try {\n            const {\n                data: txid\n            } = await axios({\n                method: 'post',\n                url: 'https://api.taal.com/api/v1/broadcast',\n                data: Buffer.from(rawTx, 'hex'),\n                headers: {\n                    'Authorization': '',\n                    'Content-Type': 'application/octet-stream'\n                },\n                timeout: time,\n                maxBodyLength: Infinity\n            });\n    \n            return txid;\n        } catch (e) {\n\n            let message = 'Unknown Error'\n\n            if(axios.isAxiosError(e)) {\n                const ae = e as AxiosError;\n                message = JSON.stringify(ae.response?.data || {});\n            } else if(e instanceof Error) {\n                message = e.message;\n            }\n\n            throw new Error('sendRawTransaction error: ' + message)\n        }\n    }\n\n    static async listUnspent(address: string): Promise<any> {\n        return axios.get(`${Whatsonchain.API_PREFIX}/address/${address}/unspent`, {\n            timeout: 30000\n        });\n    }\n\n    static getTxUri(txid: string): string {\n        return `${Whatsonchain.TX_URL_PREFIX}/${txid}`;\n    }\n}\n","import { UTXO, wallet, SignType, Network } from './wallet';\nimport { bsv } from 'scryptlib';\nimport { Gorillapool} from './gorillapool';\n\n\nexport class SensiletWallet extends wallet {\n  static DEBUG_TAG = 'Sensilet';\n  sensilet: any;\n\n  constructor(network: Network = Network.Testnet) {\n    super(network);\n    if (typeof (window as any).sensilet !== 'undefined') {\n      console.log(SensiletWallet.DEBUG_TAG, 'Sensilet is installed!');\n      this.sensilet = (window as any).sensilet \n    } else {\n      console.warn(SensiletWallet.DEBUG_TAG, \"sensilet is not installed\");\n    }\n  }\n\n  requestAccount(name: string, permissions: string[]): Promise<any> {\n\n    if(!this.sensilet) {\n      if(typeof (window as any).sensilet === 'undefined') {\n        alert(\"sensilet is not installed\");\n         window.open(\"https://sensilet.com/\", '_blank');\n      } else  {\n        console.log(SensiletWallet.DEBUG_TAG, 'Sensilet is installed!');\n        this.sensilet = (window as any).sensilet \n        return this.sensilet.requestAccount()\n      }\n    }\n\n    return this.sensilet.requestAccount()\n  }\n\n  async isConnected(): Promise<boolean> {\n    try {\n      console.log(SensiletWallet.DEBUG_TAG, 'isConnect')\n      if (typeof this.sensilet !== 'undefined') {\n        let isConnected = await this.sensilet.isConnect();\n        console.log(SensiletWallet.DEBUG_TAG, 'connect state', isConnected);\n        return isConnected;\n      } \n\n    } catch (error) {\n      console.error('isConnected error', error)\n    }\n    return false;\n  }\n\n\n  async getbalance(): Promise<number> {\n    try {\n      let res = await this.sensilet.getBsvBalance();\n      console.log(SensiletWallet.DEBUG_TAG, 'getbalance', res.balance)\n      return Promise.resolve(res.balance.total);\n    } catch (error) {\n      console.error('getbalance error', error);\n    }\n\n    return Promise.resolve(0)\n  }\n\n  async signRawTransaction(rawtx: string,\n    script: string, \n    satoshis: number, \n    inputIndex: number, \n    sigHashType: SignType\n  ): Promise<string> {\n\n    let res = await this.sensilet.signTx({\n      list:[\n        {\n          txHex: rawtx,\n          address: getAddressFromP2PKH(script, this.network),\n          scriptHex: script,\n          inputIndex: inputIndex,\n          satoshis: satoshis,\n          sigtype: sigHashType\n        }\n      ]\n    });\n\n    const unlockScript = new bsv.Script()\n    .add(Buffer.from(res.sigList[0].sig,'hex'))\n    .add(Buffer.from(res.sigList[0].publicKey,'hex'));\n\n    return unlockScript.toHex();\n  }\n\n\n\n  async getSignature(rawtx: string,\n    script: string, \n    satoshis: number,\n    inputIndex: number, \n    sigHashType: SignType,\n    address: string\n  ): Promise<{\n    signature: string,\n    publickey: string\n  }> {\n\n    let res = await this.sensilet.signTx({\n      list:[\n        {\n          txHex: rawtx,\n          address: address,\n          inputIndex:inputIndex,\n          satoshis:satoshis,\n          scriptHex: script,\n          sigtype: sigHashType\n        }\n      ]\n    });\n\n    return {\n      signature: res.sigList[0].sig,\n      publickey:  res.sigList[0].publickey,\n    }\n\n  }\n\n  async sendRawTransaction(rawTx: string): Promise<string> {\n    return Gorillapool.sendRawTransaction(rawTx);\n  }\n\n  async listUnspent(minAmount: number, options?: { purpose?: string; }): Promise<UTXO[]> {\n\n    let address = await this.sensilet.getAddress();\n    console.log(SensiletWallet.DEBUG_TAG, 'listUnspent', address)\n    return Gorillapool.listUnspent(address).then(res => {\n      return res.data.filter((utxo: any) => utxo.value >= minAmount).map((utxo: any) => {\n        return {\n          txId: utxo.tx_hash,\n          outputIndex: utxo.tx_pos,\n          satoshis: utxo.value,\n          script: bsv.Script.buildPublicKeyHashOut(address).toHex(),\n        } as UTXO;\n      });\n    });\n  }\n\n\n  async getRawChangeAddress(options?: { purpose?: string; }): Promise<string> {\n    return this.sensilet.getAddress();\n  }\n\n\n  async getPublicKey(options?: { purpose?: string; }): Promise<string> {\n    return this.sensilet.getPublicKey();\n  }\n\n\n  async getNetwork(options?: { purpose?: string; }): Promise<Network> {\n    const address = await this.sensilet.getAddress();\n    const a = new bsv.Address.fromString(address);\n    return a.network.name === 'testnet' ? Network.Testnet : Network.Mainnet;\n  }\n}\n\nfunction getAddressFromP2PKH(script: string, network: Network) : string {\n  const asm = bsv.Script.fromHex(script).toASM();\n  //OP_DUP OP_HASH160 ${address} OP_EQUALVERIFY OP_CHECKSIG\n  const pubKeyHash = asm.split(' ')[2]; //get address from script\n  const address = new bsv.Address.fromHex(`${network === Network.Testnet ?  '6f' : '00'}${pubKeyHash}`).toString();\n  return address\n}","import { Gorillapool } from \"./gorillapool\";\nimport { Whatsonchain } from \"./whatsonchain\";\n\nexport enum Network {\n  Testnet = 'testnet',\n  Regtest = 'regtest',\n  Mainnet = 'mainnet',\n  STN = 'STN'\n}\n\nexport interface UTXO {\n  txId: string,\n  outputIndex: number;\n  satoshis: number;\n  script: string;\n  address?: string;\n  pubkey?: string\n}\n\n\nexport interface Account {\n  name: string,\n  paymail: string,\n  address: string,\n  permissions?: string[]\n}\n\n\n\n\nexport enum SignType {\n  ALL = 0x00000001 | 0x00000040,\n  SINGLE = 0x00000003 | 0x00000040,\n  NONE = 0x00000002 | 0x00000040,\n  ANYONECANPAY_ALL = 0x00000001 | 0x00000040 | 0x00000080,\n  ANYONECANPAY_SINGLE = 0x00000003 | 0x00000040 | 0x00000080,\n  ANYONECANPAY_NONE = 0x00000002 | 0x00000040 | 0x00000080\n}\n\n\nexport abstract class wallet {\n\n  network: Network;\n\n  constructor(network: Network) {\n    this.network = network;\n    Gorillapool.setNetwork(this.network);\n    Whatsonchain.setNetwork(this.network);\n  }\n\n  // Check if the wallet is ready. If not ready, use requestAccount to setup.\n  abstract isConnected(): Promise<boolean>;\n\n  //Dapp use this api to connect to the wallet.\n  abstract requestAccount(name: string, permissions: string[]): Promise<any>;\n\n  //get wallet balance\n  abstract getbalance(): Promise<number>;\n\n  //sign raw transaction, returns unlockscript of the p2pkh input if success\n  abstract signRawTransaction(rawtx: string, script: string, satoshis: number, inputIndex: number, sigHashType: SignType\n  ): Promise<string>;\n\n  //get signature for special input\n  abstract getSignature(rawtx: string, script: string, satoshis: number, inputIndex: number, sigHashType: SignType, address: string\n  ): Promise<{\n    signature: string,\n    publickey: string\n  }>;\n\n  //send raw transaction, returns transaction hash if success\n  abstract sendRawTransaction(rawTx: string): Promise<string>;\n\n  //returns array of unspent transaction outputs, which total amount is more than the minAmount argument.\n  abstract listUnspent(minAmount: number, options?: {\n    purpose?: string\n  }): Promise<UTXO[]>;\n\n  //returns a new Bitcoin address, for receiving change.\n  abstract getRawChangeAddress(options?: {\n    purpose?: string\n  }): Promise<string>;\n\n  //returns a public key\n  abstract getPublicKey(options?: {\n    purpose?: string\n  }): Promise<string>;\n\n  //returns current network\n  abstract getNetwork(options?: { purpose?: string; }): Promise<Network>;\n\n}","import { bsv, AbstractContract} from 'scryptlib';\nimport { UTXO, wallet, SignType } from './wallet';\nimport axios from 'axios';\n\nconst WEB3_VERSION = '0.0.2';\n\n\nexport class web3 {\n\n  static wallet: wallet;\n\n  static setWallet(wallet: wallet) {\n    web3.wallet = wallet;\n  }\n\n\n  static version() {\n    return WEB3_VERSION;\n  }\n\n\n  static loadContractDesc(url: string): Promise<any> {\n    return axios.get(url, {\n      timeout: 10000\n    }).then(res => {\n      return res.data;\n    });\n  }\n\n\n  static async getChangeAddress(): Promise<string> {\n    return web3.wallet.getRawChangeAddress();\n  }\n\n\n  static async sendRawTx(rawTx: string): Promise<string> {\n    return web3.wallet.sendRawTransaction(rawTx);\n  }\n\n\n  static async deploy(contract: AbstractContract, amountInContract: number): Promise<string> {\n    const wallet = web3.wallet\n\n    const changeAddress = await web3.wallet.getRawChangeAddress();\n\n    return wallet.listUnspent(amountInContract, {\n      purpose: 'listUnspent'\n    }).then(async (utxos: UTXO[]) => {\n      if(utxos.length === 0) {\n        throw new Error('Insufficient balance!')\n      }\n      const tx = new bsv.Transaction();\n      tx.from([utxos[0]])\n        .addOutput(new bsv.Transaction.Output({\n          script: contract.lockingScript,\n          satoshis: amountInContract,\n        }))\n        .change(changeAddress);\n\n        const unlockScript = await wallet.signRawTransaction(tx.toString(), utxos[0].script, utxos[0].satoshis, 0, SignType.ALL);\n\n        tx.inputs[0].setScript(bsv.Script.fromHex(unlockScript));\n\n        return tx.toString();\n    }).then(async (rawTx: string) => {\n      await web3.sendRawTx(rawTx);\n      return rawTx;\n    })\n  }\n\n  static async call(contractUtxo: UTXO,\n    cbBuildTx: (tx: bsv.Transaction) => Promise<void>,\n  ): Promise<string> {\n    const tx = new bsv.Transaction();\n\n    const prevLockingScript = bsv.Script.fromHex(contractUtxo.script);\n    tx.addInput(new bsv.Transaction.Input({\n      prevTxId: contractUtxo.txId,\n      outputIndex: contractUtxo.outputIndex,\n      script: new bsv.Script(), // placeholder\n      output: new bsv.Transaction.Output({\n        script: prevLockingScript,\n        satoshis: contractUtxo.satoshis,\n      })\n    }));\n    await cbBuildTx(tx);\n    const rawTx = tx.toString();\n    await web3.sendRawTx(rawTx);\n    return rawTx;\n  }\n}","import React, { useEffect, useState } from 'react';\nimport { web3 } from './web3';\nexport const WelcomeScreen = ({ startPlay, desc, setDesc }) => {\n\n  const [loading, setLoading] = useState(true); // play or welcome\n  // Similar to componentDidMount and componentDidUpdate:\n  useEffect(() => {\n    async function fetchContract() {\n      let desc = await web3.loadContractDesc(\n        \"/zk-battleship/battleship_release_desc.json\"\n      );\n      return desc;\n    }\n\n    if(!desc) {\n      fetchContract().then(desc => {\n        setDesc(desc)\n        setLoading(false)\n      })\n      .catch(e => {\n        console.error('load desc error:', e)\n      })\n    }\n  });\n  return (\n    <main>\n      <h2 className=\"tip-box-title\">Rules</h2>\n      <p className=\"player-tip\">\n        You and your opponent are competing navy commanders. Your fleets are positioned at\n        secret coordinates, and you take turns firing torpedoes at each other. The first\n        to sink the other person’s whole fleet wins!\n      </p>\n      <button onClick={startPlay}>{loading ? \"loading...\" : \"Play\"}</button>\n    </main>\n  );\n};\n","import { toHex, bsv } from \"scryptlib\";\nimport { Network } from \"./web3\";\n\n\nexport const Player = {\n  Computer: 'computer',\n  You: 'you'\n};\n\n// store alice and bob's Privkey\nexport const PlayerPrivkey = {\n  get: (player) => {\n    return localStorage.getItem(player);\n  },\n  set: (player, key) => {\n    localStorage.setItem(player, key);\n  },\n};\n\n// store alice and bob's PublicKey, readonly\nexport const PlayerPublicKey = {\n  get: (player) => {\n    const key = PlayerPrivkey.get(player);\n    const privateKey = new bsv.PrivateKey.fromWIF(key);\n    const publicKey = bsv.PublicKey.fromPrivateKey(privateKey);\n    return toHex(publicKey);\n  }\n};\n\nexport const PlayerPKH = {\n  get: (player) => {\n    const key = PlayerPrivkey.get(player);\n    const privateKey = new bsv.PrivateKey.fromWIF(key);\n    const publicKey = bsv.PublicKey.fromPrivateKey(privateKey);\n    const pkh = bsv.crypto.Hash.sha256ripemd160(publicKey.toBuffer())\n    return toHex(pkh);\n  }\n};\n\n// store alice and bob's PublicKey Address, readonly\nexport const PlayerAddress = {\n  get: (player) => {\n    const key = PlayerPrivkey.get(player);\n    const privateKey = new bsv.PrivateKey.fromWIF(key);\n    return privateKey.toAddress().toString();\n  }\n};\n\n// store current player\nexport const CurrentPlayer = {\n  get: () => {\n    return localStorage[`player`] || Player.Computer;\n  },\n  set: (player) => {\n    localStorage.setItem(`player`, player);\n  },\n};\n\n// Randomly generated alice and bob privateKey\nexport const initPlayer = () => {\n\n  const alice = PlayerPrivkey.get(Player.Computer);\n\n  if(!alice) {\n    const aliceKey = new bsv.PrivateKey.fromRandom();\n    PlayerPrivkey.set(Player.Computer, aliceKey.toWIF())\n  }\n\n  const bob = PlayerPrivkey.get(Player.You);\n\n  if(!bob) {\n    const bobKey = new bsv.PrivateKey.fromRandom();\n    PlayerPrivkey.set(Player.You, bobKey.toWIF())\n  }\n}\n\n// store game data\nexport const GameData = {\n  get: () => {\n    const gameStr = localStorage[`game`];\n    return gameStr ? JSON.parse(gameStr) : {};\n  },\n  set: (game) => {\n    localStorage.setItem(`game`, JSON.stringify(game));\n  },\n  update: (game) => {\n    const now = GameData.get();\n    localStorage.setItem(`game`, JSON.stringify(Object.assign(now, game)));\n  },\n  clear: () => {\n    localStorage.setItem(`game`, JSON.stringify({}));\n  },\n};\n\n\n// store all utxos related to the contract\nexport const ContractUtxos = {\n  add: (rawTx, player, index = 0) => {\n    const tx = new bsv.Transaction(rawTx);\n    const utxos = ContractUtxos.get();\n    const utxo = {\n      utxo: {\n        txId: tx.id,\n        outputIndex: 0,\n        satoshis: tx.outputs[0].satoshis\n      },\n      index: index,\n      player: player,\n    };\n    utxos.push(utxo)\n    ContractUtxos.set(utxos)\n    console.log('save: utxo:', utxo.utxo.txId)\n    return utxo;\n  },\n  get: () => {\n    const utxosStr = localStorage[`utxos`];\n    return utxosStr ? JSON.parse(utxosStr) : [];\n  },\n\n  getComputerUtxoByIndex: (index) => {\n    const utxos = ContractUtxos.get();\n    return utxos.find(utxo => {\n      return utxo.index === index && !utxo.player;\n    })\n  },\n\n  getPlayerUtxoByIndex: (index) => {\n    const utxos = ContractUtxos.get();\n    return utxos.find(utxo => {\n      return utxo.index === index && utxo.player;\n    })\n  },\n  set: (utxos) => {\n    localStorage.setItem(`utxos`, JSON.stringify(utxos));\n  },\n  clear: () => {\n    localStorage.setItem(`utxos`, JSON.stringify([]));\n  },\n  getlast: () => {\n    const utxos = ContractUtxos.get();\n    return utxos[utxos.length - 1];\n  },\n\n  getdeploy: () => {\n    const utxos = ContractUtxos.get();\n    return utxos[0];\n  },\n};\n\n\nexport const CurrentNetwork = {\n  get: () => {\n    return localStorage[`network`] === 'main' ?  Network.Mainnet : Network.Testnet;\n  },\n  switch: () => {\n    const network = CurrentNetwork.get();\n    localStorage.setItem(`network`, network === Network.Mainnet ? 'test' : 'main');\n  },\n};\n","import React from 'react';\nimport { useState, useEffect } from \"react\";\nimport { Network, web3 } from \"../web3\";\nconst Balance = ({\n  balance\n}) => {\n  const [_balance, setBalance] = useState(0);\n  const [address, setAddress] = useState(\"\");\n  const [network, setNetwork] = useState(\"\");\n  useEffect(() => {\n    if (web3.wallet) {\n      web3.wallet.getbalance().then((balance) => {\n        setBalance(balance);\n      });\n\n      web3.wallet.getRawChangeAddress().then((address) => {\n        setAddress(address);\n      });\n\n      web3.wallet.getNetwork().then((network) => {\n        if (network === Network.Testnet) {\n          setNetwork('Testnet')\n        } else {\n          setNetwork('Mainnet')\n        }\n      });\n    }\n  }, []);\n\n  return (\n    <div className=\"wallet\">\n      <div className=\"walletInfo\">\n        <div className=\"balance\">\n          <label>Balance: {balance > 0 ? balance : _balance} <span> (satoshis)</span></label>\n          <br></br>\n          <label>Network: {network} </label>\n          <br></br>\n          <label>Address: {address} </label>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default Balance;","import React from 'react';\n\nexport const ReplicaBox = ({\n  shipName,\n  selectShip,\n  availableShips,\n  isCurrentlyPlacing,\n}) => {\n  let ship = availableShips.find((item) => item.name === shipName);\n  let shipLength = new Array(ship.length).fill('ship');\n  let allReplicaSquares = shipLength.map((item, index) => (\n    <div className=\"small-square\" key={index} />\n  ));\n\n  return (\n    <div\n      id={`${shipName}-replica`}\n      onClick={() => selectShip(shipName)}\n      key={`${shipName}`}\n      className={isCurrentlyPlacing ? 'replica placing' : 'replica'}\n    >\n      <div className=\"replica-title\">{shipName}</div>\n      <div className=\"replica-squares\">{allReplicaSquares}</div>\n    </div>\n  );\n};\n","import React from 'react';\nimport { ReplicaBox } from './ReplicaBox';\n\nexport const PlayerFleet = ({\n  availableShips,\n  selectShip,\n  currentlyPlacing,\n  startTurn,\n  startAgain,\n}) => {\n  let shipsLeft = availableShips.map((ship) => ship.name);\n\n  // For every ship still available, return a Replica Box with the ship's name and as many squares as its length\n  let shipReplicaBoxes = shipsLeft.map((shipName) => (\n    <ReplicaBox\n      selectShip={selectShip}\n      key={shipName}\n      isCurrentlyPlacing={currentlyPlacing && currentlyPlacing.name === shipName}\n      shipName={shipName}\n      availableShips={availableShips}\n    />\n  ));\n\n  let fleet = (\n    <div id=\"replica-fleet\">\n      {shipReplicaBoxes}\n      <p className=\"player-tip\">Right click to rotate before you position.</p>\n      <p className=\"restart\" onClick={startAgain}>\n        Restart\n      </p>\n    </div>\n  );\n\n  let playButton = (\n    <div id=\"play-ready\">\n      <p className=\"player-tip\">Ships are in formation.</p>\n      <button id=\"play-button\" onClick={startTurn}>\n        Start game\n      </button>\n    </div>\n  );\n\n  return (\n    <div id=\"available-ships\">\n      <div className=\"tip-box-title\"> Your Ships</div>\n      {availableShips.length > 0 ? fleet : playButton}\n    </div>\n  );\n};\n","export const BOARD_ROWS = 10;\nexport const BOARD_COLUMNS = 10;\nexport const BOARD = BOARD_COLUMNS * BOARD_ROWS;\n\nexport const SQUARE_STATE = {\n  empty: 'empty',\n  ship: 'ship',\n  hit: 'hit',\n  miss: 'miss',\n  ship_sunk: 'ship-sunk',\n  forbidden: 'forbidden',\n  awaiting: 'awaiting',\n};\n\nexport const stateToClass = {\n  [SQUARE_STATE.empty]: 'empty',\n  [SQUARE_STATE.ship]: 'ship',\n  [SQUARE_STATE.hit]: 'hit',\n  [SQUARE_STATE.miss]: 'miss',\n  [SQUARE_STATE.ship_sunk]: 'ship-sunk',\n  [SQUARE_STATE.forbidden]: 'forbidden',\n  [SQUARE_STATE.awaiting]: 'awaiting',\n};\n\n// Returns an empty board\nexport const generateEmptyLayout = () => {\n  return new Array(BOARD_ROWS * BOARD_COLUMNS).fill(SQUARE_STATE.empty);\n};\n\n// Returns the index of a clicked square from coordinates and viceversa\nexport const coordsToIndex = (coordinates) => {\n  const { x, y } = coordinates;\n\n  return y * BOARD_ROWS + x;\n};\n\nexport const indexToCoords = (index) => {\n  return {\n    x: index % BOARD_ROWS,\n    y: Math.floor(index / BOARD_ROWS),\n  };\n};\n// Returns the indices that entity would take up\nexport const entityIndices = (entity) => {\n  let position = coordsToIndex(entity.position);\n\n  let indices = [];\n\n  for (let i = 0; i < entity.length; i++) {\n    indices.push(position);\n    position = entity.orientation === 'vertical' ? position + BOARD_ROWS : position + 1;\n  }\n\n  return indices;\n};\n\n// Alternative take\nexport const entityIndices2 = (entity) => {\n  let indices = [];\n  for (let i = 0; i < entity.length; i++) {\n    const position =\n      entity.orientation === 'vertical'\n        ? coordsToIndex({ y: entity.position.y + i, x: entity.position.x })\n        : coordsToIndex({ y: entity.position.y, x: entity.position.x + i });\n    indices.push(position);\n  }\n\n  return indices;\n};\n\n// If it fits, I sits. Checks the ship doesn't overflow\nexport const isWithinBounds = (entity) => {\n  return (\n    (entity.orientation === 'vertical' &&\n      entity.position.y + entity.length <= BOARD_ROWS) ||\n    (entity.orientation === 'horizontal' &&\n      entity.position.x + entity.length <= BOARD_COLUMNS)\n  );\n};\n\n// Place an entity on a layout\nexport const putEntityInLayout = (oldLayout, entity, type) => {\n  let newLayout = oldLayout.slice();\n\n  if (type === 'ship') {\n    entityIndices(entity).forEach((idx) => {\n      newLayout[idx] = SQUARE_STATE.ship;\n    });\n  }\n\n  if (type === 'forbidden') {\n    entityIndices(entity).forEach((idx) => {\n      newLayout[idx] = SQUARE_STATE.forbidden;\n    });\n  }\n\n  if (type === 'hit') {\n    newLayout[coordsToIndex(entity.position)] = SQUARE_STATE.hit;\n  }\n\n  if (type === 'miss') {\n    newLayout[coordsToIndex(entity.position)] = SQUARE_STATE.miss;\n  }\n\n  if (type === 'ship-sunk') {\n    entityIndices(entity).forEach((idx) => {\n      newLayout[idx] = SQUARE_STATE.ship_sunk;\n    });\n  }\n\n  return newLayout;\n};\n\n// Check that the indices of the ship currently being placed all correspond to empty squares\nexport const isPlaceFree = (entity, layout) => {\n  let shipIndices = entityIndices2(entity);\n\n  return shipIndices.every((idx) => layout[idx] === SQUARE_STATE.empty);\n};\n\n// Used during placement to calculate how many squares a ship is out of bounds, so that the remaining squares on the board turn red\nexport const calculateOverhang = (entity) =>\n  Math.max(\n    entity.orientation === 'vertical'\n      ? entity.position.y + entity.length - BOARD_ROWS\n      : entity.position.x + entity.length - BOARD_COLUMNS,\n    0\n  );\n\n// Checks if the ship you're trying to place is within bounds and the space is free. Both need to return true\nexport const canBePlaced = (entity, layout) =>\n  isWithinBounds(entity) && isPlaceFree(entity, layout);\n\n// Generates layout and assigns each comp ship a random orientation and set of coordinates; returns all placed ships\nexport const placeAllComputerShips = (computerShips) => {\n  let compLayout = generateEmptyLayout();\n\n  return computerShips.map((ship) => {\n    while (true) {\n      let decoratedShip = randomizeShipProps(ship);\n\n      if (canBePlaced(decoratedShip, compLayout)) {\n        compLayout = putEntityInLayout(compLayout, decoratedShip, SQUARE_STATE.ship);\n        return { ...decoratedShip, placed: true };\n      }\n    }\n  });\n};\n\n// Generate a random orientation and starting index on board for computer ships\nexport const generateRandomOrientation = () => {\n  let randomNumber = Math.floor(Math.random() * Math.floor(2));\n\n  return randomNumber === 1 ? 'vertical' : 'horizontal';\n};\n\nexport const generateRandomIndex = (value = BOARD) => {\n  return Math.floor(Math.random() * Math.floor(value));\n};\n\n// Assign a ship a random orientation and set of coordinates\nexport const randomizeShipProps = (ship) => {\n  let randomStartIndex = generateRandomIndex();\n\n  return {\n    ...ship,\n    position: indexToCoords(randomStartIndex),\n    orientation: generateRandomOrientation(),\n  };\n};\n\n// Place the computer ship in the layout\nexport const placeCompShipInLayout = (ship, compLayout) => {\n  let newCompLayout = compLayout.slice();\n\n  entityIndices2(ship).forEach((idx) => {\n    newCompLayout[idx] = SQUARE_STATE.ship;\n  });\n  return newCompLayout;\n};\n\n// Gets the neighboring squares to a successful computer hit\nexport const getNeighbors = (coords) => {\n  let firstRow = coords.y === 0;\n  let lastRow = coords.y === 9;\n  let firstColumn = coords.x === 0;\n  let lastColumn = coords.x === 9;\n\n  let neighbors = [];\n\n  // coords.y === 0;\n  if (firstRow) {\n    neighbors.push(\n      { x: coords.x + 1, y: coords.y },\n      { x: coords.x - 1, y: coords.y },\n      { x: coords.x, y: coords.y + 1 }\n    );\n  }\n\n  // coords.y === 9;\n  if (lastRow) {\n    neighbors.push(\n      { x: coords.x + 1, y: coords.y },\n      { x: coords.x - 1, y: coords.y },\n      { x: coords.x, y: coords.y - 1 }\n    );\n  }\n  // coords.x === 0\n  if (firstColumn) {\n    neighbors.push(\n      { x: coords.x + 1, y: coords.y }, // right\n      { x: coords.x, y: coords.y + 1 }, // down\n      { x: coords.x, y: coords.y - 1 } // up\n    );\n  }\n\n  // coords.x === 9\n  if (lastColumn) {\n    neighbors.push(\n      { x: coords.x - 1, y: coords.y }, // left\n      { x: coords.x, y: coords.y + 1 }, // down\n      { x: coords.x, y: coords.y - 1 } // up\n    );\n  }\n\n  if (!lastColumn || !firstColumn || !lastRow || !firstRow) {\n    neighbors.push(\n      { x: coords.x - 1, y: coords.y }, // left\n      { x: coords.x + 1, y: coords.y }, // right\n      { x: coords.x, y: coords.y - 1 }, // up\n      { x: coords.x, y: coords.y + 1 } // down\n    );\n  }\n\n  let filteredResult = [\n    ...new Set(\n      neighbors\n        .map((coords) => coordsToIndex(coords))\n        .filter((number) => number >= 0 && number < BOARD)\n    ),\n  ];\n\n  return filteredResult;\n};\n\n// Give ships a sunk flag to update their color\nexport const updateSunkShips = (currentHits, opponentShips) => {\n  let playerHitIndices = currentHits.map((hit) => coordsToIndex(hit.position));\n\n  let indexWasHit = (index) => playerHitIndices.includes(index);\n\n  let shipsWithSunkFlag = opponentShips.map((ship) => {\n    let shipIndices = entityIndices2(ship);\n    if (shipIndices.every((idx) => indexWasHit(idx))) {\n      return { ...ship, sunk: true };\n    } else {\n      return { ...ship, sunk: false };\n    }\n  });\n\n  return shipsWithSunkFlag;\n};\n","import React from 'react';\nimport { ContractUtxos } from '../storage';\nimport { Whatsonchain } from '../web3';\nimport {\n  SQUARE_STATE,\n  stateToClass,\n  generateEmptyLayout,\n  putEntityInLayout,\n  indexToCoords,\n  calculateOverhang,\n  canBePlaced,\n} from './layoutHelpers';\n\nexport const PlayerBoard = ({\n  currentlyPlacing,\n  setCurrentlyPlacing,\n  rotateShip,\n  placeShip,\n  placedShips,\n  hitsByComputer,\n  hitsProofToComputer,\n  playSound,\n}) => {\n  // Player ships on empty layout\n  let layout = placedShips.reduce(\n    (prevLayout, currentShip) =>\n      putEntityInLayout(prevLayout, currentShip, SQUARE_STATE.ship),\n    generateEmptyLayout()\n  );\n\n  // Hits by computer\n  layout = hitsByComputer.reduce(\n    (prevLayout, currentHit) =>\n      putEntityInLayout(prevLayout, currentHit, currentHit.type),\n    layout\n  );\n\n  layout = placedShips.reduce(\n    (prevLayout, currentShip) =>\n      currentShip.sunk\n        ? putEntityInLayout(prevLayout, currentShip, SQUARE_STATE.ship_sunk)\n        : prevLayout,\n    layout\n  );\n\n  const isPlacingOverBoard = currentlyPlacing && currentlyPlacing.position != null;\n  const canPlaceCurrentShip = isPlacingOverBoard && canBePlaced(currentlyPlacing, layout);\n\n  if (isPlacingOverBoard) {\n    if (canPlaceCurrentShip) {\n      layout = putEntityInLayout(layout, currentlyPlacing, SQUARE_STATE.ship);\n    } else {\n      let forbiddenShip = {\n        ...currentlyPlacing,\n        length: currentlyPlacing.length - calculateOverhang(currentlyPlacing),\n      };\n      layout = putEntityInLayout(layout, forbiddenShip, SQUARE_STATE.forbidden);\n    }\n  }\n\n\n\n\n  let squares = layout.map((square, index) => {\n    const hitProofStatus = hitsProofToComputer.get(index);\n    return (\n      <div\n        onMouseDown={rotateShip}\n        onClick={() => {\n          if (canPlaceCurrentShip) {\n            playSound('click');\n            placeShip(currentlyPlacing);\n          } else if(hitProofStatus && hitProofStatus.status === 'verified') {\n            const utxo = ContractUtxos.getComputerUtxoByIndex(index);\n            if(utxo) {\n              window.open(Whatsonchain.getTxUri(utxo.utxo.txId), '_blank').focus();\n            } else {\n              console.error('utxo not found for index: ', index)\n            }\n          }\n        }}\n        className={`square ${stateToClass[square]} ${hitProofStatus ? hitProofStatus.status : ''}`}\n        key={`square-${index}`}\n        id={`square-${index}`}\n        onMouseOver={() => {\n          if (currentlyPlacing) {\n            setCurrentlyPlacing({\n              ...currentlyPlacing,\n              position: indexToCoords(index),\n            });\n          }\n        }}\n      />\n    );\n  });\n\n  return (\n    <div>\n      <h2 className=\"player-title\">You</h2>\n      <div className=\"board\">{squares}</div>\n    </div>\n  );\n};\n","import React from 'react';\nimport { ContractUtxos } from '../storage';\nimport { Whatsonchain } from '../web3';\nimport {\n  stateToClass,\n  generateEmptyLayout,\n  putEntityInLayout,\n  SQUARE_STATE,\n  indexToCoords,\n  updateSunkShips,\n} from './layoutHelpers';\n\nexport const ComputerBoard = ({\n  computerShips,\n  gameState,\n  hitsByPlayer,\n  hitsByComputer,\n  setHitsByPlayer,\n  handleComputerTurn,\n  checkIfGameOver,\n  setComputerShips,\n  playSound,\n  handleFire,\n  hitsProofToPlayer,\n}) => {\n  // Ships on an empty layout\n  let compLayout = computerShips.reduce(\n    (prevLayout, currentShip) =>\n      putEntityInLayout(prevLayout, currentShip, SQUARE_STATE.ship),\n    generateEmptyLayout()\n  );\n\n  //  Add hits dealt by player\n  compLayout = hitsByPlayer.reduce(\n    (prevLayout, currentHit) =>\n      putEntityInLayout(prevLayout, currentHit, currentHit.type),\n    compLayout\n  );\n\n  compLayout = computerShips.reduce(\n    (prevLayout, currentShip) =>\n      currentShip.sunk\n        ? putEntityInLayout(prevLayout, currentShip, SQUARE_STATE.ship_sunk)\n        : prevLayout,\n    compLayout\n  );\n\n  // Check what's at the square and decide what next\n  const fireTorpedo = (index) => {\n    if (compLayout[index] === 'ship') {\n      const newHits = [\n        ...hitsByPlayer,\n        {\n          position: indexToCoords(index),\n          type: SQUARE_STATE.hit,\n        },\n      ];\n      setHitsByPlayer(newHits);\n\n      let successfulYourHits = newHits.filter((hit) => hit.type === 'hit').length;\n      let successfulComputerHits = hitsByComputer.filter((hit) => hit.type === 'hit')\n        .length;\n\n      handleFire('player', index, true, {\n        successfulYourHits: successfulYourHits,\n        successfulComputerHits: successfulComputerHits,\n        yourTurn: false\n      });\n\n      return newHits;\n    }\n    if (compLayout[index] === 'empty') {\n      const newHits = [\n        ...hitsByPlayer,\n        {\n          position: indexToCoords(index),\n          type: SQUARE_STATE.miss,\n        },\n      ];\n      setHitsByPlayer(newHits);\n\n      let successfulYourHits = newHits.filter((hit) => hit.type === 'hit').length;\n      let successfulComputerHits = hitsByComputer.filter((hit) => hit.type === 'hit')\n        .length;\n\n      handleFire('player', index, false, {\n        successfulYourHits: successfulYourHits,\n        successfulComputerHits: successfulComputerHits,\n        yourTurn: false\n      });\n      return newHits;\n    }\n  };\n\n  const playerTurn = gameState === 'player-turn';\n  const playerCanFire = playerTurn && !checkIfGameOver();\n\n  let alreadyHit = (index) =>\n    compLayout[index] === 'hit' ||\n    compLayout[index] === 'miss' ||\n    compLayout[index] === 'ship-sunk';\n    \n  let compSquares = compLayout.map((square, index) => {\n    const hitProofStatus = hitsProofToPlayer.get(index);\n    return (\n      <div\n        // Only display square if it's a hit, miss, or sunk ship\n        className={\n          stateToClass[square] === 'hit' ||\n          stateToClass[square] === 'miss' ||\n          stateToClass[square] === 'ship-sunk'\n            ? `square ${stateToClass[square]} ${hitProofStatus ? hitProofStatus.status : ''}`\n            : `square`\n        }\n        key={`comp-square-${index}`}\n        id={`comp-square-${index}`}\n        onClick={async () => {\n          if (playerCanFire && !alreadyHit(index)) {\n\n            const newHits = fireTorpedo(index);\n\n            const shipsWithSunkFlag = updateSunkShips(newHits, computerShips);\n            const sunkShipsAfter = shipsWithSunkFlag.filter((ship) => ship.sunk).length;\n            const sunkShipsBefore = computerShips.filter((ship) => ship.sunk).length;\n            if (sunkShipsAfter > sunkShipsBefore) {\n              playSound('sunk');\n            }\n\n            setComputerShips(shipsWithSunkFlag);\n\n            handleComputerTurn();\n            \n          } else if(hitProofStatus && hitProofStatus.status === 'verified') { // TODO: use somthing like `hitsTxStatus` to replace `hitProofStatus`\n\n            const utxo = ContractUtxos.getPlayerUtxoByIndex(index);\n      \n            if(utxo) {\n              window.open(Whatsonchain.getTxUri(utxo.utxo.txId), '_blank').focus();\n            } else {\n              console.error('utxo not found for index: ', index)\n            }\n          }\n        }}\n      />\n    );\n  });\n\n  return (\n    <div>\n      <h2 className=\"player-title\">Computer</h2>\n      <div className=\"board\">{compSquares}</div>\n    </div>\n  );\n};\n","import React from 'react';\nimport { Whatsonchain } from '../web3';\n\nexport const PlayerTips = ({\n  gameState,\n  hitsbyPlayer,\n  hitsByComputer,\n  startAgain,\n  winner,\n  deployTxid,\n}) => {\n  let numberOfHits = hitsbyPlayer.length;\n  let numberOfSuccessfulHits = hitsbyPlayer.filter((hit) => hit.type === 'hit').length;\n  let accuracyScore = Math.round(100 * (numberOfSuccessfulHits / numberOfHits));\n  let succesfulComputerHits = hitsByComputer.filter((hit) => hit.type === 'hit').length;\n\n  let gameOverPanel = (\n    <div>\n      <div className=\"tip-box-title\">Game Over!</div>\n      <p className=\"player-tip\">\n        {winner === 'player' ? 'You win! 🎉' : 'You lose 😭. Better luck next time! '}\n      </p>\n      <p className=\"restart\" onClick={startAgain}>\n        Play again?\n      </p>\n    </div>\n  );\n\n  let tipsPanel = (\n    <div>\n      <div className=\"tip-box-title\">Stats</div>\n      <div id=\"firing-info\">\n        <ul>\n          <li>deploy txid: <a href={Whatsonchain.getTxUri(deployTxid)} target=\"_blank\" rel=\"noopener noreferrer\">{deployTxid.substr(0, 6)}</a></li>\n          <li>{numberOfSuccessfulHits} successful hits</li>\n          <li>{accuracyScore > 0 ? `${accuracyScore}%` : `0%`} accuracy </li>\n        </ul>\n        <p className=\"player-tip\">The first to sink all 5 opponent ships wins.</p>\n        <p className=\"restart\" onClick={startAgain}>\n          Restart\n        </p>\n      </div>\n    </div>\n  );\n\n  return (\n    <div id=\"player-tips\">\n      {numberOfSuccessfulHits === 17 || succesfulComputerHits === 17\n        ? gameOverPanel\n        : tipsPanel}\n    </div>\n  );\n};\n","import React from 'react';\n\nimport { PlayerFleet } from './PlayerFleet';\nimport { PlayerBoard } from './PlayerBoard';\nimport { ComputerBoard } from './ComputerBoard';\nimport { PlayerTips } from './PlayerTips';\n\nexport const GameView = ({\n  availableShips,\n  selectShip,\n  currentlyPlacing,\n  setCurrentlyPlacing,\n  rotateShip,\n  placeShip,\n  placedShips,\n  startTurn,\n  computerShips,\n  computerShipsHash,\n  gameState,\n  changeTurn,\n  hitsByPlayer,\n  setHitsByPlayer,\n  hitsByComputer,\n  hitsProofToComputer,\n  hitsProofToPlayer,\n  hitComputer, // <- setHitsByComputer ?\n  handleComputerTurn,\n  checkIfGameOver,\n  startAgain,\n  winner,\n  setComputerShips,\n  playSound,\n  deployTxid,\n  handleFire\n}) => {\n  return (\n    <section id=\"game-screen\">\n      {gameState !== 'placement' ? (\n        <PlayerTips\n          gameState={gameState}\n          hitsbyPlayer={hitsByPlayer}\n          hitsByComputer={hitsByComputer}\n          winner={winner}\n          deployTxid={deployTxid}\n          startAgain={startAgain}\n        />\n      ) : (\n        <PlayerFleet\n          availableShips={availableShips}\n          selectShip={selectShip}\n          currentlyPlacing={currentlyPlacing}\n          startTurn={startTurn}\n          startAgain={startAgain}\n        />\n      )}\n\n      <PlayerBoard\n        currentlyPlacing={currentlyPlacing}\n        setCurrentlyPlacing={setCurrentlyPlacing}\n        rotateShip={rotateShip}\n        placeShip={placeShip}\n        placedShips={placedShips}\n        hitsByComputer={hitsByComputer}\n        hitsProofToComputer={hitsProofToComputer}\n        playSound={playSound}\n      />\n      <ComputerBoard\n        computerShips={computerShips}\n        changeTurn={changeTurn}\n        gameState={gameState}\n        hitComputer={hitComputer}\n        hitsByPlayer={hitsByPlayer}\n        hitsByComputer={hitsByComputer}\n        setHitsByPlayer={setHitsByPlayer}\n        handleComputerTurn={handleComputerTurn}\n        checkIfGameOver={checkIfGameOver}\n        setComputerShips={setComputerShips}\n        hitsProofToPlayer={hitsProofToPlayer}\n        playSound={playSound}\n        handleFire={handleFire}\n      />\n    </section>\n  );\n};\n","\nexport class CircomProvider {\n  static instance;\n\n  constructor(program, proving_key, verification_key) {\n    this.program = program;\n    this.proving_key = proving_key;\n    this.verification_key = verification_key;\n  }\n\n  static async init() {\n    // console.log('ZKP init...')\n    if (CircomProvider.instance) return CircomProvider;\n    try {\n      let verification_key = await fetch('/zk-battleship/zk/verification_key.json').then(resp => resp.json());\n      CircomProvider.instance = new CircomProvider(\n        \"/zk-battleship/zk/battleship.wasm\",\n        \"/zk-battleship/zk/circuit_final.zkey\",\n        verification_key\n      );\n      console.log('ZKP initialized.')\n      return CircomProvider;\n    } catch (error) {\n      console.log('init CircomProvider fail', error)\n    }\n  }\n\n  static generateProof(witness) {\n    if (!CircomProvider.instance) {\n      throw Error('Uninitilized CircomProvider, call `CircomProvider.init()` first!');\n    }\n    return new Promise(async resolve => {\n      const { proof, publicSignals } =\n      await window.snarkjs.groth16.fullProve(witness, CircomProvider.instance.program, CircomProvider.instance.proving_key);\n\n      resolve({ proof, publicSignals, isHit: publicSignals[0] === \"1\" } );\n    });\n  }\n\n  static verify({ proof, publicSignals } ) {\n    if (!CircomProvider.instance) {\n      throw Error('Uninitilized CircomProvider, call `CircomProvider.init()` first!');\n    }\n    return new Promise(async resolve => {\n      const res = await window.snarkjs.groth16.verify(CircomProvider.instance.verification_key, publicSignals, proof);\n      resolve(res);\n    });\n  }\n}","/* global BigInt */\nimport React, { useEffect, useRef, useState } from 'react';\nimport { bsv, buildContractClass, getPreimage, Int, PubKey, signTx } from 'scryptlib';\nimport { ContractUtxos, Player, PlayerPKH, PlayerPrivkey, PlayerPublicKey } from '../storage';\nimport { web3 } from '../web3';\nimport Balance from './balance';\nimport { GameView } from './GameView';\nimport { buildMimc7 } from 'circomlibjs';\n\nimport {\n  coordsToIndex, generateEmptyLayout,\n  generateRandomIndex,\n  getNeighbors, indexToCoords, placeAllComputerShips, putEntityInLayout, SQUARE_STATE, updateSunkShips\n} from './layoutHelpers';\n\nimport Queue from \"queue-promise\";\nimport { CircomProvider } from '../circomProvider';\n\nconst AVAILABLE_SHIPS = [\n  {\n    name: 'carrier',\n    length: 5,\n    placed: null,\n  },\n  {\n    name: 'battleship',\n    length: 4,\n    placed: null,\n  },\n  {\n    name: 'cruiser',\n    length: 3,\n    placed: null,\n  },\n  {\n    name: 'submarine',\n    length: 3,\n    placed: null,\n  },\n  {\n    name: 'destroyer',\n    length: 2,\n    placed: null,\n  },\n];\n\n\nfunction runCircom(privateInputs, publicInputs) {\n  return CircomProvider\n    .init()\n    .then(async () => {\n      return CircomProvider.generateProof({\n        \"boardHash\": publicInputs[0],\n        \"guess\": publicInputs.slice(1),\n        \"ships\": privateInputs\n      });\n    })\n    .then(async ({ proof, publicSignals, isHit }) => {\n      const isVerified = await CircomProvider.verify({ proof, publicSignals });\n      return { isVerified, proof, isHit };\n    })\n    .catch(e => {\n      console.error('runCircom error:', e)\n      return {\n        isVerified: false\n      }\n    })\n}\n\nexport const Game = ({ desc }) => {\n  const [gameState, setGameState] = useState('placement');\n  const [winner, setWinner] = useState(null);\n\n  const [currentlyPlacing, setCurrentlyPlacing] = useState(null);\n  const [placedShips, setPlacedShips] = useState([]);\n  const [placedShipsHash, setPlacedShipsHash] = useState([]);\n  const [availableShips, setAvailableShips] = useState(AVAILABLE_SHIPS);\n  const [computerShips, setComputerShips] = useState([]);\n  const [computerShipsHash, setComputerShipsHash] = useState([]);\n  const [hitsByPlayer, setHitsByPlayer] = useState([]);\n  const [hitsByComputer, setHitsByComputer] = useState([]);\n  const [hitsProofToComputer, setHitsProofToComputer] = useState(new Map()); // index: number => {status: 'pending'/'verified', proof?: object}\n  const [hitsProofToPlayer, setHitsProofToPlayer] = useState(new Map()); // structure same as above\n  const [battleShipContract, setBattleShipContract] = useState(null); // contract\n  const [deployTxid, setDeployTxid] = useState('');\n  const [balance, setBalance] = useState(-1);\n  const [queue, setQueue] = useState(null);\n\n  const hp2CRef = useRef(hitsProofToComputer);\n  useEffect(() => {\n    hp2CRef.current = hitsProofToComputer\n  }, [hitsProofToComputer]);\n\n  const hp2PRef = useRef(hitsProofToPlayer);\n  useEffect(() => {\n    hp2PRef.current = hitsProofToPlayer\n  }, [hitsProofToPlayer]);\n\n  const hbpRef = useRef(hitsByPlayer);\n  useEffect(() => {\n    hbpRef.current = hitsByPlayer\n  }, [hitsByPlayer]);\n\n  const hbcRef = useRef(hitsByComputer);\n  useEffect(() => {\n    hbcRef.current = hitsByComputer\n  }, [hitsByComputer]);\n\n  useEffect(() => {\n    const queue = new Queue({\n      concurrent: 1,\n      interval: 2000\n    });\n\n    setQueue(queue)\n\n    return (() => {\n      queue.stop();\n    })\n  }, []);\n\n\n\n  // *** PLAYER ***\n  const selectShip = (shipName) => {\n    let shipIdx = availableShips.findIndex((ship) => ship.name === shipName);\n    const shipToPlace = availableShips[shipIdx];\n\n    setCurrentlyPlacing({\n      ...shipToPlace,\n      orientation: 'horizontal',\n      position: null,\n    });\n  };\n\n  const move = async (isPlayerFired, index, contractUtxo, hit, proof, newStates) => {\n\n    console.log('call move ...', 'index=', index, newStates, contractUtxo)\n\n\n    console.time('t0')\n    return web3.call(contractUtxo, async (tx) => {\n\n      if (newStates.successfulYourHits === 17) {\n        const amount = contractUtxo.satoshis - tx.getEstimateFee();\n\n        if (amount < 1) {\n          alert('Not enough funds.');\n          throw new Error('Not enough funds.')\n        }\n\n        tx.setOutput(0, (tx) => {\n          return new bsv.Transaction.Output({\n            script: bsv.Script.buildPublicKeyHashOut(PlayerPKH.get(Player.Computer)),\n            satoshis: amount,\n          })\n        })\n\n      } else if (newStates.successfulComputerHits === 17) {\n        tx.setOutput(0, (tx) => {\n          const amount = contractUtxo.satoshis - tx.getEstimateFee();\n          if (amount < 1) {\n            alert('Not enough funds.');\n            throw new Error('Not enough funds.')\n          }\n\n          return new bsv.Transaction.Output({\n            script: bsv.Script.buildPublicKeyHashOut(PlayerPKH.get(Player.You)),\n            satoshis: amount,\n          })\n        })\n\n      } else {\n        tx.setOutput(0, (tx) => {\n          const amount = contractUtxo.satoshis - tx.getEstimateFee();\n\n          if (amount < 1) {\n            alert('Not enough funds.');\n            throw new Error('Not enough funds.')\n          }\n\n          const newLockingScript = battleShipContract.getNewStateScript(newStates);\n\n          return new bsv.Transaction.Output({\n            script: newLockingScript,\n            satoshis: amount,\n          })\n        })\n      }\n\n\n      tx.setInputScript(0, (tx, output) => {\n        const preimage = getPreimage(tx, output.script, output.satoshis)\n        const currentTurn = !newStates.yourTurn;\n        const privateKey = new bsv.PrivateKey.fromWIF(currentTurn ? PlayerPrivkey.get(Player.You) : PlayerPrivkey.get(Player.Computer));\n        const sig = signTx(tx, privateKey, output.script, output.satoshis)\n        const position = indexToCoords(index);\n\n        let amount = contractUtxo.satoshis - tx.getEstimateFee();\n\n        if (amount < 1) {\n          alert('Not enough funds.');\n          throw new Error('Not enough funds.')\n        }\n\n        return battleShipContract.move(sig, position.x, position.y, hit, proof, amount, preimage).toScript();\n      })\n        .seal();\n\n\n    }).then(async rawTx => {\n      console.timeEnd('t0')\n      ContractUtxos.add(rawTx, isPlayerFired, index);\n\n      battleShipContract.successfulYourHits = newStates.successfulYourHits;\n      battleShipContract.successfulComputerHits = newStates.successfulComputerHits;\n      battleShipContract.yourTurn = newStates.yourTurn;\n\n      setTimeout(async () => {\n        web3.wallet.getbalance().then(balance => {\n          console.log('update balance:', balance)\n          setBalance(balance)\n        })\n      }, 5000);\n\n    })\n      .catch(e => {\n        console.error('call contract fail', e)\n      })\n\n  }\n\n  const placeShip = (currentlyPlacing) => {\n    setPlacedShips([\n      ...placedShips,\n      {\n        ...currentlyPlacing,\n        placed: true,\n      },\n    ]);\n\n    setAvailableShips((previousShips) =>\n      previousShips.filter((ship) => ship.name !== currentlyPlacing.name)\n    );\n\n    setCurrentlyPlacing(null);\n  };\n\n  const rotateShip = (event) => {\n    if (currentlyPlacing != null && event.button === 2) {\n      setCurrentlyPlacing({\n        ...currentlyPlacing,\n        orientation:\n          currentlyPlacing.orientation === 'vertical' ? 'horizontal' : 'vertical',\n      });\n    }\n  };\n\n  const startTurn = async () => {\n\n    const computerShips_ = generateComputerShips();\n    const BattleShip = buildContractClass(desc);\n\n    const playerHash = await shipHash(placedShips);\n    const computerHash = await shipHash(computerShips_);\n\n    const contract = new BattleShip(new PubKey(PlayerPublicKey.get(Player.You)),\n      new PubKey(PlayerPublicKey.get(Player.Computer)),\n      new Int(playerHash), new Int(computerHash), 0, 0, true);\n\n    setBattleShipContract(contract);\n\n    try {\n\n      ContractUtxos.clear();\n\n      const rawTx = await web3.deploy(contract, 20000);\n\n      ContractUtxos.add(rawTx, 0, -1);\n\n      const txid = ContractUtxos.getdeploy().utxo.txId\n\n      setDeployTxid(txid)\n\n      setTimeout(async () => {\n        web3.wallet.getbalance().then(balance => {\n          console.log('update balance:', balance)\n          setBalance(balance)\n        })\n      }, 10000);\n    } catch (error) {\n      console.error(\"deploy contract fails\", error);\n      setBattleShipContract(null);\n      alert(\"deploy contract error:\" + error.message);\n      return;\n    }\n\n\n    setGameState('player-turn');\n\n    setPlacedShipsHash(playerHash);\n\n    setComputerShipsHash(computerHash);\n  };\n\n  const changeTurn = () => {\n    setGameState((oldGameState) =>\n      oldGameState === 'player-turn' ? 'computer-turn' : 'player-turn'\n    );\n  };\n\n  // *** COMPUTER ***\n  const generateComputerShips = () => {\n    let placedComputerShips = placeAllComputerShips(AVAILABLE_SHIPS.slice());\n\n    setComputerShips(placedComputerShips);\n    return placedComputerShips\n  };\n\n  const computerFire = (index, layout) => {\n    let computerHits;\n    let fireResult;\n    if (layout[index] === 'ship') {\n      fireResult = {\n        position: indexToCoords(index),\n        type: SQUARE_STATE.hit,\n      };\n      computerHits = [\n        ...hitsByComputer,\n        fireResult,\n      ];\n    }\n    if (layout[index] === 'empty') {\n      fireResult = {\n        position: indexToCoords(index),\n        type: SQUARE_STATE.miss,\n      }\n      computerHits = [\n        ...hitsByComputer,\n        fireResult,\n      ];\n    }\n    const sunkShips = updateSunkShips(computerHits, placedShips);\n    const sunkShipsAfter = sunkShips.filter((ship) => ship.sunk).length;\n    const sunkShipsBefore = placedShips.filter((ship) => ship.sunk).length;\n    if (sunkShipsAfter > sunkShipsBefore) {\n      playSound('sunk');\n    }\n    setPlacedShips(sunkShips);\n    setHitsByComputer(computerHits);\n\n    if (fireResult) {\n\n      let successfulYourHits = hbpRef.current.filter((hit) => hit.type === 'hit').length;\n      let successfulComputerHits = computerHits.filter((hit) => hit.type === 'hit')\n        .length;\n\n      handleFire('computer', index, fireResult.type === 'hit', {\n        successfulYourHits: successfulYourHits,\n        successfulComputerHits: successfulComputerHits,\n        yourTurn: true\n      });\n    }\n  };\n\n  // Change to computer turn, check if game over and stop if yes; if not fire into an eligible square\n  const handleComputerTurn = () => {\n    changeTurn();\n\n    if (checkIfGameOver()) {\n      return;\n    }\n\n    // Recreate layout to get eligible squares\n    let layout = placedShips.reduce(\n      (prevLayout, currentShip) =>\n        putEntityInLayout(prevLayout, currentShip, SQUARE_STATE.ship),\n      generateEmptyLayout()\n    );\n\n    layout = hitsByComputer.reduce(\n      (prevLayout, currentHit) =>\n        putEntityInLayout(prevLayout, currentHit, currentHit.type),\n      layout\n    );\n\n    layout = placedShips.reduce(\n      (prevLayout, currentShip) =>\n        currentShip.sunk\n          ? putEntityInLayout(prevLayout, currentShip, SQUARE_STATE.ship_sunk)\n          : prevLayout,\n      layout\n    );\n\n    let successfulComputerHits = hitsByComputer.filter((hit) => hit.type === 'hit');\n\n    let nonSunkComputerHits = successfulComputerHits.filter((hit) => {\n      const hitIndex = coordsToIndex(hit.position);\n      return layout[hitIndex] === 'hit';\n    });\n\n    let potentialTargets = nonSunkComputerHits\n      .flatMap((hit) => getNeighbors(hit.position))\n      .filter((idx) => layout[idx] === 'empty' || layout[idx] === 'ship');\n\n    // Until there's a successful hit\n    if (potentialTargets.length === 0) {\n      let layoutIndices = layout.map((item, idx) => idx);\n      potentialTargets = layoutIndices.filter(\n        (index) => layout[index] === 'ship' || layout[index] === 'empty'\n      );\n    }\n\n    let randomIndex = generateRandomIndex(potentialTargets.length);\n\n    let target = potentialTargets[randomIndex];\n\n    setTimeout(() => {\n      computerFire(target, layout);\n      changeTurn();\n    }, 300);\n  };\n\n  // *** END GAME ***\n\n  // Check if either player or computer ended the game\n  const checkIfGameOver = () => {\n    let successfulPlayerHits = hitsByPlayer.filter((hit) => hit.type === 'hit').length;\n    let successfulComputerHits = hitsByComputer.filter((hit) => hit.type === 'hit')\n      .length;\n\n    if (successfulComputerHits === 17 || successfulPlayerHits === 17) {\n      setGameState('game-over');\n\n      if (successfulComputerHits === 17) {\n        setWinner('computer');\n        playSound('lose');\n      }\n      if (successfulPlayerHits === 17) {\n        setWinner('player');\n        playSound('win');\n      }\n\n      return true;\n    }\n\n    return false;\n  };\n\n  const startAgain = () => {\n    setGameState('placement');\n    setWinner(null);\n    setCurrentlyPlacing(null);\n    setPlacedShips([]);\n    setAvailableShips(AVAILABLE_SHIPS);\n    setComputerShips([]);\n    setHitsByPlayer([]);\n    setHitsByComputer([]);\n    setHitsProofToComputer(new Map());\n    setHitsProofToPlayer(new Map());\n    ContractUtxos.clear();\n  };\n\n  const handleFire = (role, targetIdx, isHit, newStates) => {\n    const isPlayerFired = role === 'player';\n    const privateInputs = toPrivateInputs(isPlayerFired ? computerShips : placedShips);\n    const position = indexToCoords(targetIdx);\n    const publicInputs = [isPlayerFired ? computerShipsHash : placedShipsHash, position.x, position.y];\n\n    if (isPlayerFired) {\n      setHitsProofToPlayer(new Map(hitsProofToPlayer.set(targetIdx, { status: 'pending' })));\n    } else {\n      setHitsProofToComputer(new Map(hitsProofToComputer.set(targetIdx, { status: 'pending' })));\n    }\n\n\n    queue.enqueue(async () => {\n      await runCircom(privateInputs, publicInputs)\n      .then(async ({isVerified, proof, isHit }) => {\n        console.log(\"isVerified\", isVerified)\n        console.log(\"isHit\", isHit)\n        console.log(proof)\n        \n        const isPlayerFired = role === 'player';\n\n        const contractUtxo = ContractUtxos.getlast().utxo;\n\n        const Proof = battleShipContract.getTypeClassByType(\"Proof\");\n        const G1Point = battleShipContract.getTypeClassByType(\"G1Point\");\n        const G2Point = battleShipContract.getTypeClassByType(\"G2Point\");\n        const FQ2 = battleShipContract.getTypeClassByType(\"FQ2\");\n\n        contractUtxo.script = battleShipContract.lockingScript.toHex();\n\n        await move(isPlayerFired, targetIdx, contractUtxo, isHit, new Proof({\n          a: new G1Point({\n            x: new Int(proof.pi_a[0]),\n            y: new Int(proof.pi_a[1]),\n          }),\n          b: new G2Point({\n            x: new FQ2({\n              x: new Int(proof.pi_b[0][0]),\n              y: new Int(proof.pi_b[0][1]),\n            }),\n            y: new FQ2({\n              x: new Int(proof.pi_b[1][0]),\n              y: new Int(proof.pi_b[1][1]),\n            })\n          }),\n          c: new G1Point({\n            x: new Int(proof.pi_c[0]),\n            y: new Int(proof.pi_c[1]),\n          })\n        }), newStates)\n          .then(() => {\n\n            if (isPlayerFired) {\n              setHitsProofToPlayer(new Map(hp2PRef.current.set(targetIdx, { status: isVerified ? 'verified' : 'failed', proof })))\n            } else {\n              setHitsProofToComputer(new Map(hp2CRef.current.set(targetIdx, { status: isVerified ? 'verified' : 'failed', proof })))\n            }\n          })\n          .catch(e => {\n            console.error(\"call contract error:\", e);\n            alert(\"call contract error:\" + e.message);\n          })\n      });\n    });\n\n    \n\n  }\n\n  // *** Zero Knowledge Proof\n\n  const sortShipsForZK = (ships) => {\n    const SORTED_ZK_SHIP_NAMES = ['carrier', 'battleship', 'cruiser', 'submarine', 'destoryer'];\n    return ships.sort((a, b) => SORTED_ZK_SHIP_NAMES.indexOf(a) - SORTED_ZK_SHIP_NAMES.indexOf(b))\n  }\n\n  const shipHash = async (ships) => {\n    let multiplier = 1n;\n    const shipPreimage =\n      sortShipsForZK(ships)\n        .reduce(\n          (res, ship) => {\n            const val = ship.position.x + ship.position.y * 16 + (ship.orientation === \"horizontal\" ? 1 : 0) * 16 * 16\n            const r = res + BigInt(val) * multiplier;\n            multiplier *= BigInt(16 ** 3);\n            return r;\n          },\n          BigInt(0)\n        );\n\n    const mimc7 = await buildMimc7();\n    return mimc7.F.toString(mimc7.hash(shipPreimage, 0));\n  }\n\n  const toPrivateInputs = (ships) => {\n\n    return ships.map(ship =>\n      [\n        ship.position.x,\n        ship.position.y,\n        ship.orientation === \"horizontal\" ? 1 : 0\n      ]\n    )\n  }\n\n\n  const sunkSoundRef = useRef(null);\n  const clickSoundRef = useRef(null);\n  const lossSoundRef = useRef(null);\n  const winSoundRef = useRef(null);\n\n  const stopSound = (sound) => {\n    sound.current.pause();\n    sound.current.currentTime = 0;\n  };\n  const playSound = (sound) => {\n    if (sound === 'sunk') {\n      stopSound(sunkSoundRef);\n      sunkSoundRef.current.play();\n    }\n\n    if (sound === 'click') {\n      stopSound(clickSoundRef);\n      clickSoundRef.current.play();\n    }\n\n    if (sound === 'lose') {\n      stopSound(lossSoundRef);\n      lossSoundRef.current.play();\n    }\n\n    if (sound === 'win') {\n      stopSound(winSoundRef);\n      winSoundRef.current.play();\n    }\n  };\n  return (\n    <React.Fragment>\n      <audio\n        ref={sunkSoundRef}\n        src=\"/zk-battleship/sounds/ship_sunk.wav\"\n        className=\"clip\"\n        preload=\"auto\"\n      />\n      <audio\n        ref={clickSoundRef}\n        src=\"/zk-battleship/sounds/click.wav\"\n        className=\"clip\"\n        preload=\"auto\"\n      />\n      <audio ref={lossSoundRef} src=\"/zk-battleship/sounds/lose.wav\" className=\"clip\" preload=\"auto\" />\n      <audio ref={winSoundRef} src=\"/zk-battleship/sounds/win.wav\" className=\"clip\" preload=\"auto\" />\n      <GameView\n        availableShips={availableShips}\n        selectShip={selectShip}\n        currentlyPlacing={currentlyPlacing}\n        setCurrentlyPlacing={setCurrentlyPlacing}\n        rotateShip={rotateShip}\n        placeShip={placeShip}\n        placedShips={placedShips}\n        startTurn={startTurn}\n        computerShips={computerShips}\n        computerShipsHash={computerShipsHash}\n        gameState={gameState}\n        changeTurn={changeTurn}\n        hitsByPlayer={hitsByPlayer}\n        setHitsByPlayer={setHitsByPlayer}\n        hitsByComputer={hitsByComputer}\n        hitsProofToComputer={hitsProofToComputer}\n        hitsProofToPlayer={hitsProofToPlayer}\n        setHitsByComputer={setHitsByComputer}\n        handleComputerTurn={handleComputerTurn}\n        checkIfGameOver={checkIfGameOver}\n        startAgain={startAgain}\n        winner={winner}\n        setComputerShips={setComputerShips}\n        playSound={playSound}\n        deployTxid={deployTxid}\n        handleFire={handleFire}\n      />\n      <Balance balance={balance}></Balance>\n    </React.Fragment>\n  );\n};\n","import React from 'react';\n\nexport const Header = () => {\n  return (\n    <header>\n      <h1> Hello Battleship</h1>\n\n      <p className=\"subtitle\"> A strategy game at sea</p>\n      <span role=\"img\" aria-label=\"anchor\">\n        ⚓️\n      </span>\n    </header>\n  );\n};\n","import React from 'react';\n\nexport const Footer = () => {\n  return (\n    <footer>\n      Made by <a href=\"https://scrypt.io\" target='_blank' rel=\"noopener noreferrer\">sCrypt Inc</a>{' '}\n      <br></br>\n      Github <a href=\"https://github.com/sCrypt-Inc/zk-battleship\" target='_blank' rel=\"noopener noreferrer\">Repo</a>{' '}\n      <br></br>\n      Fontend credit to <a href=\"https://github.com/diemkay/battleship\" target='_blank' rel=\"noopener noreferrer\">diemkay</a>{' '}\n    </footer>\n  );\n};\n","import React, { useState, useEffect} from 'react';\nimport ReactDOM from 'react-dom';\nimport { WelcomeScreen } from './WelcomeScreen';\nimport { Game } from './Game/Game.js';\nimport { Header } from './Header';\nimport { Footer } from './Footer';\n\nimport './css/style.css';\nimport { Network, SensiletWallet, web3} from './web3';\nimport { initPlayer } from './storage';\nimport { bsv } from 'scryptlib/dist';\n\nexport const App = () => {\n  const [appState, setAppState] = useState('welcome'); // play or welcome\n\n  const [desc, setDesc] = useState(null); // play or welcome\n\n  useEffect(() => {\n\n    bsv.Transaction.FEE_PER_KB = 0.0001\n    const script = document.createElement('script');\n  \n    script.src = \"/zk-battleship/zk/snarkjs.min.js\";\n    script.async = true;\n  \n    document.body.appendChild(script);\n  \n    return () => {\n      document.body.removeChild(script);\n    }\n  }, []);\n\n  const startPlay = async () => {\n\n    const wallet =  new SensiletWallet();\n    web3.setWallet(wallet);\n    const isConnected = await web3.wallet.isConnected();\n\n    if(isConnected) {\n      const n = await wallet.getNetwork();\n\n      if(n === Network.Mainnet) {\n\n        alert(\"your sensilet wallet's network is mainnet, switch to testnet before playing.\");\n        return;\n      }\n\n      web3.setWallet(new SensiletWallet(n));\n\n      setAppState('play');\n    } else {\n\n      try {\n        const res = await web3.wallet.requestAccount(\"battleship\");\n        if (res) {\n          setAppState('play');\n        }\n      } catch (error) {\n        console.error(\"requestAccount error\", error);\n      }\n\n    }\n  };\n\n  // Renders either Welcome Screen or Game\n  return (\n    <React.Fragment>\n      <Header />\n      {appState === 'play' ? <Game desc={desc}/> : <WelcomeScreen startPlay={startPlay} desc={desc} setDesc={setDesc} />}\n      <Footer />\n    </React.Fragment>\n  );\n};\n\ninitPlayer();\nReactDOM.render(<App />, document.getElementById('root'));\n","\nimport axios, { AxiosError } from 'axios';\nimport { Network } from './wallet';\n\n\n\n\nexport class Gorillapool {\n    static API_PREFIX = ``;\n    static TX_URL_PREFIX = ``;\n    static setNetwork(network: Network) {\n\n        Gorillapool.API_PREFIX = `https://api.whatsonchain.com/v1/bsv/${network === Network.Testnet ? 'test' : 'main'}`;\n        Gorillapool.TX_URL_PREFIX = `${network === Network.Testnet ? 'https://classic-test.whatsonchain.com/tx' : 'https://classic.whatsonchain.com/tx'}`;\n    }\n\n    \n    static async sendRawTransaction(txhex: string) {\n\n\n        // 1 second per KB\n        const size = Math.max(1, txhex.length / 2 / 1024); //KB\n        const time = Math.max(100000, 1000 * size);\n\n        try {\n            const {\n                data\n            } = await axios({\n                method: 'post',\n                url: `https://testnet.merchantapi.gorillapool.io/mapi/tx`,\n                data: Buffer.from(txhex, 'hex'),\n                headers: {\n                    'Accept': 'text/plain',\n                    'Content-Type': 'application/octet-stream',\n                    'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOiIyMDIzLTA5LTExVDEyOjI4OjQ0LjA5OTU3MjE5OFoiLCJuYW1lIjoibmFubyJ9.hPTPj8ZClo7n9f_9ZJVWonvrNBlWj1igv88uIYUEHTU'\n                },\n                timeout: time,\n                maxBodyLength: Infinity\n            });\n        \n            const payload = JSON.parse(data.payload)\n            if(payload.returnResult === 'success') {\n                return payload.txid;\n            } else if(payload.returnResult === 'failure') {\n                console.error('sendTx error:', txhex)\n                throw new Error(payload.resultDescription)\n            }\n        \n            throw new Error('sendTx error')\n        } catch (e) {\n\n            let message = 'Unknown Error'\n\n            if(axios.isAxiosError(e)) {\n                const ae = e as AxiosError;\n                message = JSON.stringify(ae.response?.data || {});\n            } else if(e instanceof Error) {\n                message = e.message;\n            }\n\n            throw new Error('sendRawTransaction error: ' + message)\n        }\n    }\n\n    static async listUnspent(address: string): Promise<any> {\n        return axios.get(`${Gorillapool.API_PREFIX}/address/${address}/unspent`, {\n            timeout: 30000\n        });\n    }\n\n    static getTxUri(txid: string): string {\n        return `${Gorillapool.TX_URL_PREFIX}/${txid}`;\n    }\n}\n"],"sourceRoot":""}